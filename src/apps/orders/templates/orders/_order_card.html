<div class="order-card
{% if order.status == "PG" %}status-pending
{% elif order.status == "RD" %}status-ready
{% elif order.status == "PD" %}status-paid
{% endif %}"> 
    <!-- TODO Обертка для содержимого карточки -->
    <a href="{% url 'orders:detail' order.id %}" class="order-card-link">
        <!-- Order Title -->
        <h2 class="order-title">Заказ #{{ order.id }}</h2>

        <!-- Order Details -->
        <p class="order-details"><strong>Номер
            стола:</strong> {{ order.table_number }}</p>
        <p class="order-details"><strong>Общая
            стоймость:</strong> {{ order.total_price }} BYN</p>
        <p class="order-details">
            <strong>Статус:</strong> {{ order.get_status_display }}</p>

        <!-- Order Items -->
        {% if order.items.all %}
            <p class="order-items-title"><strong>Список блюд:</strong></p>
            <ul class="order-items">
                {% for item in order.items.all|slice:":4" %}
                    <li>
                        <span>{{ item.dish }} {{ item.price }} BYN - {{ item.quantity }} шт.</span>
                    </li>
                {% endfor %}
            </ul>
            {% if order.items.all|length > 4 %}
                <li class="ellipsis">
                    <a href="{% url 'orders:detail' order.id %}">Посмотреть
                        все {{ order.items.all|length }} блюд </a>
                </li>
            {% endif %}
        {% else %}
            <p class="empty-message">В этом заказе пока нет блюд.</p>
        {% endif %}
    </a>

    <!-- Кнопки действий -->
    <div class="order-actions">
        <!-- Кнопка смены статуса -->
        <a href="{% url 'orders:update' order.id %}" class="update-status-btn">Изменить</a>

        <!-- Форма для удаления -->
        <form action="{% url 'orders:delete' order.id %}" method="post"
              class="delete-form">
            {% csrf_token %}
            <button type="submit" class="delete-order-btn">Удалить</button>
        </form>
    </div>
</div>

<!-- Модальное окно для подтверждения удаления -->
<div id="deleteConfirmationModal" class="modal">
    <div class="modal-content">
        <div class="model-content-text">
            Вы уверены, что хотите удалить этот заказ?
        </div>
        <div class="modal-actions">
            <button id="confirmDeleteBtn" class="confirm-btn">Да, удалить
            </button>
            <button id="cancelDeleteBtn" class="cancel-btn">Отмена</button>
        </div>
    </div>
</div>


<script defer>
    document.addEventListener('DOMContentLoaded', function () {
        const deleteButtons = document.querySelectorAll('.delete-order-btn');
        const modal = document.getElementById('deleteConfirmationModal');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');

        let deleteForm = null;

        // Открываем модальное окно при клике на кнопку удаления
        deleteButtons.forEach(button => {
            button.addEventListener('click', function (e) {
                e.preventDefault(); // Предотвращаем переход по ссылке
                deleteForm = button.closest('form'); // Находим форму для удаления
                modal.classList.add('show'); // Показываем модальное окно с анимацией
            });
        });

        // Подтверждение удаления
        confirmDeleteBtn.addEventListener('click', function () {
            if (deleteForm) {
                const orderCard = deleteForm.closest('.order-card');
                orderCard.classList.add('removing'); // Анимация удаления карточки

                // Удаляем карточку после завершения анимации
                setTimeout(() => {
                    deleteForm.submit(); // Отправляем форму
                }, 200); // Время должно совпадать с длительностью анимации
            }
        });

        // Отмена удаления
        cancelDeleteBtn.addEventListener('click', function () {
            modal.classList.remove('show'); // Скрываем модальное окно с анимацией
        });

        // Закрытие модального окна при клике вне его области
        window.addEventListener('click', function (e) {
            if (e.target === modal) {
                modal.classList.remove('show'); // Скрываем модальное окно с анимацией
            }
        });
    });
</script>